'use client';

import Image from 'next/image';
import Link from 'next/link';
import { useState } from 'react';
import OptimizedImagePlaceholder from '../components/OptimizedImagePlaceholder';

interface TipoProbioticosTemplateProps {
  titulo: string;
  descripcion: string;
  imagenPrincipal: {
    src: string;
    alt: string;
  };
  fechaPublicacion: string;
  introduccion: string;
  caracteristicas: {
    titulo: string;
    descripcion: string;
  }[];
  beneficios: {
    titulo: string;
    descripcion: string;
  }[];
  cepasPopulares: {
    nombre: string;
    descripcion: string;
    beneficios: string[];
    condiciones?: string[];
  }[];
  alimentosNaturales?: {
    nombre: string;
    descripcion: string;
    imagen?: {
      src: string;
      alt: string;
    };
  }[];
  estudiosRelevantes: {
    titulo: string;
    autores: string;
    año: string;
    publicacion: string;
    url?: string;
    resumen: string;
  }[];
  faq: {
    pregunta: string;
    respuesta: string;
  }[];
  seccionesContenido?: {
    titulo: string;
    contenido: React.ReactNode;
  }[];
}

export default function TipoProbioticosTemplate({
  titulo,
  descripcion,
  imagenPrincipal,
  fechaPublicacion,
  introduccion,
  caracteristicas,
  beneficios,
  cepasPopulares,
  alimentosNaturales,
  estudiosRelevantes,
  faq,
  seccionesContenido
}: TipoProbioticosTemplateProps) {
  const [expandedFaq, setExpandedFaq] = useState<number | null>(null);
  const [expandedStudy, setExpandedStudy] = useState<number | null>(null);

  // Datos estructurados JSON-LD para SEO
  const structuredData = {
    "@context": "https://schema.org",
    "@type": "Article",
    "headline": titulo,
    "description": descripcion,
    "image": {
      "@type": "ImageObject",
      "url": `https://www.probioticosparatodos.com${imagenPrincipal.src}`,
      "width": 1200,
      "height": 630,
      "alt": imagenPrincipal.alt
    },
    "author": {
      "@type": "Organization",
      "name": "Probióticos Para Todos",
      "url": "https://www.probioticosparatodos.com"
    },
    "publisher": {
      "@type": "Organization",
      "name": "Probióticos Para Todos",
      "logo": {
        "@type": "ImageObject",
        "url": "https://www.probioticosparatodos.com/images/logo_transparente.png"
      }
    },
    "datePublished": fechaPublicacion,
    "dateModified": new Date().toISOString(),
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id": `https://www.probioticosparatodos.com/tipos/${titulo.toLowerCase().replace(/\s+/g, '-')}`
    },
    "articleSection": "Salud y Bienestar",
    "keywords": [`${titulo}`, "probióticos", "salud digestiva", "microbioma", "bacterias beneficiosas"]
  };

  const faqStructuredData = {
    "@context": "https://schema.org",
    "@type": "FAQPage",
    "mainEntity": faq.map(item => ({
      "@type": "Question",
      "name": item.pregunta,
      "acceptedAnswer": {
        "@type": "Answer",
        "text": item.respuesta
      }
    }))
  };

  const toggleFaq = (index: number) => {
    setExpandedFaq(expandedFaq === index ? null : index);
  };

  const toggleStudy = (index: number) => {
    setExpandedStudy(expandedStudy === index ? null : index);
  };

  return (
    <>
      {/* Datos estructurados JSON-LD */}
      <script 
        type="application/ld+json"
        dangerouslySetInnerHTML={{ __html: JSON.stringify(structuredData) }}
      />
      <script 
        type="application/ld+json"
        dangerouslySetInnerHTML={{ __html: JSON.stringify(faqStructuredData) }}
      />

      {/* Header moderno con gradient */}
      <header className="bg-gradient-to-r from-apple to-st-tropaz text-white py-16 relative overflow-hidden" role="banner">
        <div className="absolute inset-0 bg-black opacity-10"></div>
        <div className="container mx-auto px-4 relative z-10">
          <div className="max-w-4xl mx-auto text-center">
            <h1 className="text-4xl sm:text-5xl lg:text-6xl font-bold mb-6 leading-tight" itemProp="headline">
              {titulo}
            </h1>
            <p className="text-xl sm:text-2xl mb-8 text-green-100 max-w-3xl mx-auto" itemProp="description">
              {descripcion}
            </p>
            
            {/* Breadcrumbs */}
            <nav aria-label="Navegación por migas de pan" className="mt-8" role="navigation">
              <ol className="flex flex-wrap justify-center text-sm opacity-90" itemScope itemType="https://schema.org/BreadcrumbList">
                <li itemProp="itemListElement" itemScope itemType="https://schema.org/ListItem" className="flex items-center">
                  <Link href="/" itemProp="item" className="hover:text-green-200 transition-colors">
                    <span itemProp="name">Inicio</span>
                  </Link>
                  <meta itemProp="position" content="1" />
                  <span className="mx-2">→</span>
                </li>
                <li itemProp="itemListElement" itemScope itemType="https://schema.org/ListItem" className="flex items-center">
                  <Link href="/tipos" itemProp="item" className="hover:text-green-200 transition-colors">
                    <span itemProp="name">Tipos</span>
                  </Link>
                  <meta itemProp="position" content="2" />
                  <span className="mx-2">→</span>
                </li>
                <li itemProp="itemListElement" itemScope itemType="https://schema.org/ListItem">
                  <span itemProp="name" className="text-green-200 font-medium" aria-current="page">{titulo}</span>
                  <meta itemProp="position" content="3" />
                </li>
              </ol>
            </nav>
          </div>
        </div>
      </header>

      {/* Imagen hero moderna */}
      <section className="py-12 bg-aqua-squeeze">
        <div className="container mx-auto px-4">
          <div className="max-w-4xl mx-auto">
            <figure className="relative w-full h-[400px] sm:h-[500px] rounded-2xl overflow-hidden shadow-2xl">
              <OptimizedImagePlaceholder 
                src={imagenPrincipal.src} 
                alt={imagenPrincipal.alt}
                width={800}
                height={500}
                className="object-cover w-full h-full transition-transform duration-300 hover:scale-105"
              />
              <div className="absolute inset-0 bg-gradient-to-t from-black/20 to-transparent"></div>
            </figure>
          </div>
        </div>
      </section>

      {/* Layout principal con grid moderno */}
      <div className="container mx-auto px-4 py-12">
        <div className="grid grid-cols-1 lg:grid-cols-4 gap-12">
          
          {/* Contenido principal */}
          <main className="lg:col-span-3 space-y-12" role="main">
            
            {/* Introducción con diseño moderno */}
            <article className="bg-white p-8 rounded-2xl shadow-lg border-l-4 border-apple">
              <div className="prose prose-lg max-w-none">
                <div 
                  dangerouslySetInnerHTML={{ __html: introduccion }} 
                  className="text-gray-700 leading-relaxed"
                />
              </div>
            </article>

            {/* Características con cards modernas */}
            <section aria-labelledby="caracteristicas-heading">
              <h2 id="caracteristicas-heading" className="text-3xl font-bold mb-8 text-biscay flex items-center">
                <span className="w-8 h-8 bg-apple rounded-full flex items-center justify-center text-white mr-3">
                  <svg className="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                  </svg>
                </span>
                Características Principales
              </h2>
              <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                {caracteristicas.map((caracteristica, index) => (
                  <article key={index} className="bg-gradient-to-br from-gossip to-aqua-squeeze p-6 rounded-xl shadow-md hover:shadow-lg transition-all duration-300 hover:translate-y-[-4px]">
                    <header>
                      <h3 className="text-xl font-semibold mb-3 text-biscay flex items-center">
                        <span className="w-6 h-6 bg-apple rounded-full flex items-center justify-center text-white text-sm mr-2">
                          {index + 1}
                        </span>
                        {caracteristica.titulo}
                      </h3>
                    </header>
                    <p className="text-gray-700 leading-relaxed">{caracteristica.descripcion}</p>
                  </article>
                ))}
              </div>
            </section>

            {/* Beneficios con iconos modernos */}
            <section aria-labelledby="beneficios-heading">
              <h2 id="beneficios-heading" className="text-3xl font-bold mb-8 text-biscay flex items-center">
                <span className="w-8 h-8 bg-st-tropaz rounded-full flex items-center justify-center text-white mr-3">
                  <svg className="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z"/>
                  </svg>
                </span>
                Beneficios para la Salud
              </h2>
              <div className="space-y-6">
                {beneficios.map((beneficio, index) => (
                  <article key={index} className="bg-white p-6 rounded-xl shadow-md border-l-4 border-seagull hover:shadow-lg transition-shadow duration-300">
                    <header>
                      <h3 className="text-xl font-semibold mb-3 text-st-tropaz">{beneficio.titulo}</h3>
                    </header>
                    <p className="text-gray-700 leading-relaxed">{beneficio.descripcion}</p>
                  </article>
                ))}
              </div>
            </section>
                  </div>
                ))}
              </div>
            </section>
            
            {/* Cepas populares */}
            <section className="bg-white p-8 rounded-lg shadow-sm mb-8">
              <h2 className="text-2xl font-bold mb-6 text-gray-800 border-b pb-2">Cepas populares</h2>
              <div className="space-y-8">
                {cepasPopulares.map((cepa, index) => (
                  <div key={index} className="bg-gray-50 p-6 rounded-lg border border-gray-200">
                    <h3 className="text-xl font-semibold mb-3 text-green-700">{cepa.nombre}</h3>
                    <p className="text-gray-700 mb-4">{cepa.descripcion}</p>
                    
                    <h4 className="font-semibold mb-2 text-gray-700">Beneficios específicos:</h4>
                    <ul className="list-disc pl-5 space-y-1 text-gray-700 mb-4">
                      {cepa.beneficios.map((beneficio, idx) => (
                        <li key={idx}>{beneficio}</li>
                      ))}
                    </ul>
                    
                    {cepa.condiciones && cepa.condiciones.length > 0 && (
                      <>
                        <h4 className="font-semibold mb-2 text-gray-700">Condiciones para las que se estudia:</h4>
                        <ul className="list-disc pl-5 space-y-1 text-gray-700">
                          {cepa.condiciones.map((condicion, idx) => (
                            <li key={idx}>{condicion}</li>
                          ))}
                        </ul>
                      </>
                    )}
                  </div>
                ))}
              </div>
            </section>
            
            {/* Alimentos naturales */}
            {alimentosNaturales && alimentosNaturales.length > 0 && (
              <section className="bg-white p-8 rounded-lg shadow-sm mb-8">
                <h2 className="text-2xl font-bold mb-6 text-gray-800 border-b pb-2">Fuentes naturales</h2>
                <div className="grid grid-cols-1 sm:grid-cols-2 gap-6">
                  {alimentosNaturales.map((alimento, index) => (
                    <div key={index} className="bg-green-50 p-4 rounded-lg border border-green-100">
                      {alimento.imagen && (
                        <div className="mb-3">
                          <div className="relative w-full h-48">
                            <Image 
                              src={alimento.imagen.src} 
                              alt={alimento.imagen.alt}
                              fill
                              sizes="(max-width: 640px) 100vw, 300px"
                              className="rounded-lg object-cover"
                            />
                          </div>
                        </div>
                      )}
                      <h3 className="text-lg font-semibold mb-2 text-green-700">{alimento.nombre}</h3>
                      <p className="text-gray-700">{alimento.descripcion}</p>
                    </div>
                  ))}
                </div>
              </section>
            )}
            
            {/* Secciones de contenido adicionales */}
            {seccionesContenido && seccionesContenido.map((seccion, index) => (
              <section key={index} className="bg-white p-8 rounded-lg shadow-sm mb-8">
                <h2 className="text-2xl font-bold mb-6 text-gray-800 border-b pb-2">{seccion.titulo}</h2>
                <div className="prose prose-green max-w-none">
                  {seccion.contenido}
                </div>
              </section>
            ))}
            
            {/* Estudios científicos */}
            <section className="bg-white p-8 rounded-lg shadow-sm mb-8">
              <h2 className="text-2xl font-bold mb-6 text-gray-800 border-b pb-2">Evidencia científica</h2>
              <div className="space-y-6">
                {estudiosRelevantes.map((estudio, index) => (
                  <div key={index} className="bg-gray-50 p-4 rounded-lg border border-gray-200">
                    <h3 className="text-lg font-semibold mb-1 text-gray-800">{estudio.titulo}</h3>
                    <p className="text-sm text-gray-500 mb-2">
                      {estudio.autores} ({estudio.año}). <em>{estudio.publicacion}</em>.
                      {estudio.url && (
                        <a 
                          href={estudio.url} 
                          target="_blank" 
                          rel="noopener noreferrer" 
                          className="ml-2 text-green-600 hover:text-green-700"
                        >
                          Ver estudio
                        </a>
                      )}
                    </p>
                    <p className="text-gray-700">{estudio.resumen}</p>
                  </div>
                ))}
              </div>
            </section>
            
            {/* FAQ */}
            <section className="bg-white p-8 rounded-lg shadow-sm mb-8">
              <h2 className="text-2xl font-bold mb-6 text-gray-800 border-b pb-2">Preguntas frecuentes</h2>
              <div className="space-y-6">
                {faq.map((item, index) => (
                  <div key={index}>
                    <h3 className="text-xl font-semibold mb-2 text-green-600">{item.pregunta}</h3>
                    <p className="text-gray-700">{item.respuesta}</p>
                  </div>
                ))}
              </div>
            </section>
          </div>
          
          {/* Sidebar */}
          <div>
            <div className="sticky top-6">
              {/* <AdBanner position="sidebar" className="mb-6" /> */}
              
              <div className="bg-green-50 p-6 rounded-lg shadow-sm border border-green-100 mb-6">
                <h3 className="text-xl font-semibold mb-4 text-gray-800">Contenido relacionado</h3>
                <ul className="space-y-3">
                  <li>
                    <Link href="/que-son" className="text-green-600 hover:text-green-700 transition-colors">
                      ¿Qué son los probióticos?
                    </Link>
                  </li>
                  <li>
                    <Link href="/beneficios" className="text-green-600 hover:text-green-700 transition-colors">
                      Beneficios de los probióticos
                    </Link>
                  </li>
                  <li>
                    <Link href="/como-elegir" className="text-green-600 hover:text-green-700 transition-colors">
                      Cómo elegir el probiótico adecuado
                    </Link>
                  </li>
                  <li>
                    <Link href="/referencias" className="text-green-600 hover:text-green-700 transition-colors">
                      Referencias científicas
                    </Link>
                  </li>
                </ul>
              </div>
              
              <div className="bg-white p-6 rounded-lg shadow-sm mb-6">
                <h3 className="text-xl font-semibold mb-4 text-gray-800">Otros tipos de probióticos</h3>
                <ul className="space-y-3">
                  <li>
                    <Link href="/tipos/lactobacillus" className="text-green-600 hover:text-green-700 transition-colors">
                      Lactobacillus
                    </Link>
                  </li>
                  <li>
                    <Link href="/tipos/bifidobacterium" className="text-green-600 hover:text-green-700 transition-colors">
                      Bifidobacterium
                    </Link>
                  </li>
                  <li>
                    <Link href="/tipos/saccharomyces" className="text-green-600 hover:text-green-700 transition-colors">
                      Saccharomyces
                    </Link>
                  </li>
                  <li>
                    <Link href="/tipos/bacillus" className="text-green-600 hover:text-green-700 transition-colors">
                      Bacillus
                    </Link>
                  </li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      {/* Bottom Ad (desactivado temporalmente) */}
      {/**
      <div className="container mx-auto px-4 py-6">
        <AdBanner position="bottom" />
      </div>
      **/}
    </>
  );
} 